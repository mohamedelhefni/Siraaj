!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Analytics=t()}(this,function(){return class e{constructor(e={}){console.log("project id is",e.projectId),this.config={apiUrl:e.apiUrl||"http://localhost:8080",projectId:e.projectId||"default",autoTrack:!1!==e.autoTrack,bufferSize:e.bufferSize||10,flushInterval:e.flushInterval||3e4,debug:e.debug||!1,...e},this.buffer=[],this.sessionId=this._getSessionId(),this.userId=this._getUserId(),this.flushTimer=null,this.config.autoTrack&&this._setupAutoTracking(),this.config.flushInterval>0&&this._startAutoFlush(),window.addEventListener("beforeunload",()=>{this.flush(!0)}),this._log("Analytics initialized",this.config)}track(e,t={}){console.log("project id",this.config.projectId);let i={event_name:e,user_id:this.userId,session_id:this.sessionId,url:window.location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:new Date().toISOString(),browser:this._getBrowser(),os:this._getOS(),device:this._getDevice(),properties:JSON.stringify(t),project_id:this.config.projectId};this._log("Tracking event:",i),this._addToBuffer(i)}pageView(e=null){this.track("page_view",{path:e||window.location.pathname,title:document.title,search:window.location.search,hash:window.location.hash}),this.flush()}identify(e,t={}){this.userId=e,localStorage.setItem("analytics_user_id",e),this.track("identify",t)}trackClick(e,t={}){this.track("click",{element:e,...t})}trackForm(e,t={}){this.track("form_submit",{form_id:e,...t})}trackError(e,t={}){this.track("error",{message:e.message||e,stack:e.stack,...t})}setUserProperties(e){this.track("user_properties_updated",e)}_addToBuffer(e){this.buffer.push(e),this.buffer.length>=this.config.bufferSize&&this.flush()}flush(e=!1){if(0===this.buffer.length)return Promise.resolve();let t=[...this.buffer];return(this.buffer=[],this._log("Flushing events:",t),e&&navigator.sendBeacon)?Promise.all(t.map(e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return navigator.sendBeacon(`${this.config.apiUrl}/api/track`,t)})):Promise.all(t.map(e=>this._sendEvent(e)))}_sendEvent(e,t=3){return fetch(`${this.config.apiUrl}/api/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0,signal:AbortSignal.timeout(1e4)}).then(t=>{if(!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`);return this._log("Event sent successfully:",e.event_name),t}).catch(i=>{if(this._log("Error sending event:",i,e),t>0&&("NetworkError"===i.name||"TypeError"===i.name))return this._log(`Retrying event send, ${t} attempts left`),new Promise(i=>{setTimeout(()=>{i(this._sendEvent(e,t-1))},1e3*(4-t))});throw 0===t&&(this.buffer.unshift(e),this._log("Event added back to buffer after failed retries")),i})}_setupAutoTracking(){"complete"===document.readyState?this.pageView():window.addEventListener("load",()=>this.pageView()),document.addEventListener("visibilitychange",()=>{this.track(document.hidden?"page_hidden":"page_visible")}),document.addEventListener("click",e=>{let t=e.target.closest("a");t&&this.track("link_clicked",{url:t.href,text:t.textContent.trim(),external:t.hostname!==window.location.hostname})}),document.addEventListener("submit",e=>{let t=e.target;t.id&&this.trackForm(t.id)}),window.addEventListener("error",e=>{this.trackError(e.error||e.message,{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.trackError(e.reason,{type:"unhandled_promise_rejection"})})}_startAutoFlush(){this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval)}_getSessionId(){let e=sessionStorage.getItem("analytics_session_id");return e||(e=this._generateId(),sessionStorage.setItem("analytics_session_id",e)),e}_getUserId(){let e=localStorage.getItem("analytics_user_id");return e||(e=this._generateId(),localStorage.setItem("analytics_user_id",e)),e}_generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}_getBrowser(){let e=navigator.userAgent;return e.indexOf("Firefox")>-1?"Firefox":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":e.indexOf("Edge")>-1?"Edge":e.indexOf("Opera")>-1||e.indexOf("OPR")>-1?"Opera":e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1?"IE":"Unknown"}_getOS(){let e=navigator.userAgent;return e.indexOf("Win")>-1?"Windows":e.indexOf("Mac")>-1?"MacOS":e.indexOf("Linux")>-1?"Linux":e.indexOf("Android")>-1?"Android":e.indexOf("iOS")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?"iOS":"Unknown"}_getDevice(){let e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"Tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"Mobile":"Desktop"}_log(...e){this.config.debug&&console.log("[Analytics]",...e)}destroy(){this.flushTimer&&clearInterval(this.flushTimer),this.flush(!0)}}});